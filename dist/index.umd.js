(function(l,n){typeof exports=="object"&&typeof module<"u"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(l=typeof globalThis<"u"?globalThis:l||self,n(l.index={}))})(this,function(l){"use strict";var M=Object.defineProperty;var R=(l,n,o)=>n in l?M(l,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[n]=o;var h=(l,n,o)=>(R(l,typeof n!="symbol"?n+"":n,o),o);const n={};class o{constructor(t,e,c){h(this,"messengers",[]);h(this,"title");h(this,"subject");h(this,"test");arguments.length===3?Object.assign(this,{title:e,subject:t,test:c}):Object.assign(this,{subject:t,test:e})}process(t,e,c,r){const{stack:u}=new Error;this.messengers.push({key:t,result:e,subject:c,target:r,stack:u})}get result(){return this.messengers.every(t=>t.result)}}const m=s=>typeof s=="string"?`"${s}"`:s,g=s=>(t,e,c,r)=>{const u=t?"color:green":"color:red";return[`%c${m(e)} %c${s} %c${m(c)}%c`,u,"font-weight:bold",u,""]},E=(s,t,e,c=[])=>{const[r,...u]=c;return[`%c${s?"✓":"✗"} %c${r}`,s?"color:green":"color:red",""].concat(u.length>0?u:[""])};class f{constructor(t,e,c){h(this,"modules",[]);h(this,"subject");h(this,"title");h(this,"func");h(this,"options");h(this,"parent");h(this,"stack",new Error().stack);if(this.subject=t,e&&c){this.options=e,this.func=c;const r=e;this.title=`${r.prefix??""} ${r.formatter?r.formatter(this.subject):this.subject+""} ${r.surfix??""}`}else e?(this.func=e,this.title=this.subject+""):(this.func=()=>{},this.title=this.subject+"")}get result(){return this.modules.every(t=>t.result)}async test(){const t=this,{subject:e,modules:c}=this;function r(a,i){const p=arguments.length===2?new o(a,i,t):new o(a,t);return t.modules.push(p),p}const u=(a,i,p)=>{const d=p?new f(a,i,p):new f(a,i);return d.parent=this,d.parent.modules.push(d),d};try{const a=this.func({expect:r,subject:e,test:u,parent:this});typeof a=="object"&&typeof a.then=="function"&&await a,c.forEach(async i=>{i instanceof o||i instanceof f&&await i.test()})}catch(a){console.error(a)}}async report(t={head:!1}){const{modules:e}=this,{head:c}=t;await(async()=>{const{result:u,title:a,stack:i}=this;let p=u?console.groupCollapsed:console.group,d=i.split(`
`);p(...E(u,null,null,[a])),console.log(d[4]),e.forEach(async y=>{!c&&y instanceof o?y.messengers.forEach(w=>{const{key:b,result:j,subject:q,target:x,stack:D}=w,{title:v}=y;let[k,...$]=g(b)(j,q,x);v&&(k=`%c${v} ${k}%c`,$=["",...$,""]),p=j?console.groupCollapsed:console.group,p(...E(j,q,x,[k,...$]));const P=D.split(`
`)[3];console.log(`%c${P.trim()}`,"text-align: right"),console.groupEnd()}):y instanceof f&&await y.report(t)}),console.groupEnd()})()}json(){const{modules:t,result:e,title:c,stack:r}=this,a=r.split(`
`)[4];return{result:e,title:c,line:a,modules:t.map(i=>({title:i.title,result:i.result,expects:i instanceof o?i.messengers.map(p=>{const{title:d}=i,{stack:y,...w}=p,b=y.split(`
`)[3];return{...w,title:d,line:b}}):void 0,tests:i instanceof f?i.json():void 0}))}}}const C=(s,t,e)=>{const c=e?new f(s,t,e):t?new f(s,t):new f(s);return c.parent=window.chk,window.chk.modules.push(c),c};o.prototype.deq=o.prototype["==="]=function(s){const{subject:t}=this;return this.process("===",t===s,t,s),this},n.deq=n["==="]=[g("===")],o.prototype.eq=o.prototype["=="]=function(s){const{subject:t}=this;return this.process("==",t==s,t,s),this},n.eq=n["=="]=[g("==")],o.prototype.greaterThan=o.prototype[">"]=function(s){const{subject:t}=this;return this.process(">",t>s,t,s),this},n.greaterThan=n[">"]=[g(">")],o.prototype.lessThan=o.prototype["<"]=function(s){const{subject:t}=this;return this.process("<",t<s,t,s),this},n.lessThan=n["<"]=[g("<")],o.prototype.ndeq=o.prototype["!=="]=function(s){const{subject:t}=this;return this.process("!==",t!==s,t,s),this},n.ndeq=n["!=="]=[g("!==")],o.prototype.neq=o.prototype["!="]=function(s){const{subject:t}=this;return this.process("!=",t!=s,t,s),this},n.neq=n["!="]=[g("!=")],o.prototype.setTitle=o.prototype.$=function(s){return this.title=s,this},o.prototype["array.contains"]=function(s){const{subject:t}=this;return this.process("array.contains",s.every(e=>t.includes(e)),t,s),this};class T{constructor(){h(this,"modules",[])}async test(){const t=+new Date,{modules:e}=this,c=[];e.forEach(r=>c.push(r.test())),await Promise.all(c),console.log(`%c TEST %c ${(+new Date-t)/1e3} ms`,"border: 1px solid gray;font-weight:bold;background-color:yellow","")}async report(t={head:!1}){const e=+new Date,{modules:c}=this,r=[];c.forEach(u=>r.push(u.report(t))),await Promise.all(r),console.log(`%c REPORT %c ${(+new Date-e)/1e3} ms`,"border: 1px solid gray;font-weight:bold;background-color:yellow","")}async run(t={head:!1}){await this.test(),await this.report(t)}json(){return this.modules.map(t=>t.json())}}window.chk=new T,l.Check=T,l.Expect=o,l.Test=f,l.format=m,l.messengers=n,l.test=C,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
